apiVersion: apps/v1
kind: Deployment
metadata:
  name: snmp-exporter
  namespace: monitoring
  labels:
    app: snmp-exporter
spec:
  replicas: 1
  selector:
    matchLabels:
      app: snmp-exporter
  template:
    metadata:
      labels:
        app: snmp-exporter
    spec:
      containers:
        - name: snmp-exporter
          image: prom/snmp-exporter:v0.26.0
          args:
            - "--config.file=/etc/snmp_exporter/snmp.yml"
          ports:
            - name: http
              containerPort: 9116
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 5
            periodSeconds: 5
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi
          volumeMounts:
            - name: config
              mountPath: /etc/snmp_exporter
      volumes:
        - name: config
          configMap:
            name: snmp-exporter-config
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: snmp-exporter-config
  namespace: monitoring
data:
  snmp.yml: |
    # Synology NAS configuration
    auths:
      public_v2:
        version: 2
        community: public
    modules:
      synology:
        walk:
          # System information
          - 1.3.6.1.2.1.1  # system
          - 1.3.6.1.2.1.25 # host resources (CPU, memory, storage)
          - 1.3.6.1.4.1.6574.1  # Synology CPU
          - 1.3.6.1.4.1.6574.2  # Synology Disk
          - 1.3.6.1.4.1.6574.3  # Synology RAID
          - 1.3.6.1.4.1.6574.4  # Synology UPS
          - 1.3.6.1.4.1.6574.5  # Synology System
          - 1.3.6.1.4.1.6574.6  # Synology Services
          - 1.3.6.1.2.1.2      # Network interfaces
          - 1.3.6.1.2.1.31     # Interface statistics
        metrics:
          # System metrics
          - name: sysUpTime
            oid: 1.3.6.1.2.1.1.3
            type: gauge
            help: System uptime
          - name: sysDescr
            oid: 1.3.6.1.2.1.1.1
            type: DisplayString
            help: System description
          # Synology specific metrics
          - name: temperature
            oid: 1.3.6.1.4.1.6574.1.2
            type: gauge
            help: Synology temperature
          - name: systemStatus
            oid: 1.3.6.1.4.1.6574.1.1
            type: gauge
            help: Synology system status
          - name: powerStatus
            oid: 1.3.6.1.4.1.6574.1.3
            type: gauge
            help: Synology power status
          - name: systemFanStatus
            oid: 1.3.6.1.4.1.6574.1.4.1
            type: gauge
            help: Synology fan status
          - name: cpuFanStatus
            oid: 1.3.6.1.4.1.6574.1.4.2
            type: gauge
            help: Synology CPU fan status
          - name: modelName
            oid: 1.3.6.1.4.1.6574.1.5.1
            type: DisplayString
            help: Synology model name
          - name: serialNumber
            oid: 1.3.6.1.4.1.6574.1.5.2
            type: DisplayString
            help: Synology serial number
          - name: version
            oid: 1.3.6.1.4.1.6574.1.5.3
            type: DisplayString
            help: DSM version
          # Disk metrics
          - name: diskID
            oid: 1.3.6.1.4.1.6574.2.1.1.2
            type: DisplayString
            help: Disk ID
            indexes:
            - labelname: diskIndex
              type: gauge
          - name: diskModel
            oid: 1.3.6.1.4.1.6574.2.1.1.3
            type: DisplayString
            help: Disk model
            indexes:
            - labelname: diskIndex
              type: gauge
          - name: diskStatus
            oid: 1.3.6.1.4.1.6574.2.1.1.5
            type: gauge
            help: Disk status (1=Normal, 2=Initialized, 3=NotInitialized, 4=SystemPartitionFailed, 5=Crashed)
            indexes:
            - labelname: diskIndex
              type: gauge
          - name: diskTemperature
            oid: 1.3.6.1.4.1.6574.2.1.1.6
            type: gauge
            help: Disk temperature
            indexes:
            - labelname: diskIndex
              type: gauge
          # RAID metrics
          - name: raidName
            oid: 1.3.6.1.4.1.6574.3.1.1.2
            type: DisplayString
            help: RAID name
            indexes:
            - labelname: raidIndex
              type: gauge
          - name: raidStatus
            oid: 1.3.6.1.4.1.6574.3.1.1.3
            type: gauge
            help: RAID status (1=Normal, 2=Repairing, 3=Migrating, 4=Expanding, 5=Deleting, 6=Creating, 7=RaidSyncing, 8=RaidParityChecking, 9=RaidAssembling, 10=Canceling, 11=Degrade, 12=Crashed)
            indexes:
            - labelname: raidIndex
              type: gauge
          # Service status
          - name: serviceName
            oid: 1.3.6.1.4.1.6574.6.1.1.2
            type: DisplayString
            help: Service name
            indexes:
            - labelname: serviceIndex
              type: gauge
          - name: serviceStatus
            oid: 1.3.6.1.4.1.6574.6.1.1.3
            type: gauge
            help: Service status (1=Running, 2=Stopped)
            indexes:
            - labelname: serviceIndex
              type: gauge
